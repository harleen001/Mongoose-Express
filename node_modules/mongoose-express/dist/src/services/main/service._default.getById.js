"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const wrapperFindByIdOptions_1 = __importDefault(require("../../classes/wrapperFindByIdOptions"));
const getTransaction_1 = __importDefault(require("../sentry/getTransaction"));
const service__default_helpers_runAllMiddleware_1 = __importDefault(require("./service._default.helpers.runAllMiddleware"));
exports.default = (model, options = {}, existingTransaction) => async (id) => {
    const transaction = (0, getTransaction_1.default)({
        name: 'service._default.getById',
        op: 'service.run'
    }, existingTransaction);
    const opts = new wrapperFindByIdOptions_1.default(options);
    await service__default_helpers_runAllMiddleware_1.default.findById(id, opts, transaction);
    const doc = model.findById(id, null, opts.mongooseModel);
    opts.options.exclude.forEach((exclude) => doc.select(`-${exclude}`));
    opts.options.populateFields.forEach(field => doc.populate(field));
    const spanDocExec = (0, getTransaction_1.default)({
        name: 'service._default.getById.exec',
        op: 'doc.exec',
    });
    const object = await doc.exec();
    spanDocExec.finish();
    transaction.finish();
    return object
        ? object.toObject()
        : null;
};
//# sourceMappingURL=service._default.getById.js.map